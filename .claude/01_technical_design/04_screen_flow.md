# 画面遷移設計

## 概要

ActionSparkの画面遷移とナビゲーション設計を定義します。

## 画面遷移図

```
┌─────────────┐
│  ランディング  │
│  (未ログイン)  │
└──────┬──────┘
       │
   ┌───┴───┐
   ▼       ▼
┌──────┐  ┌──────┐
│ログイン│  │新規登録│
└──┬───┘  └──┬───┘
   │         │
   └────┬────┘
        ▼
┌─────────────┐     ┌─────────────┐
│  投稿一覧    │────→│   投稿詳細   │
│  (トップ)    │←────│            │
└──────┬──────┘     └──────┬──────┘
       │                   │
   ┌───┼───┐           ┌───┴───┐
   ▼   ▼   ▼           ▼       ▼
┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐
│新規│ │マイ│ │検索│ │編集│ │削除│
│投稿│ │ページ│ │結果│ │    │ │確認│
└────┘ └────┘ └────┘ └────┘ └────┘
```

## 画面一覧

### 認証系

| 画面名 | パス | 説明 |
|--------|------|------|
| ログイン | `/users/sign_in` | メール/パスワード、Google OAuth |
| 新規登録 | `/users/sign_up` | ユーザー登録 |
| パスワード再設定 | `/users/password/new` | パスワードリセットメール送信 |

### メイン機能

| 画面名 | パス | 説明 |
|--------|------|------|
| 投稿一覧 | `/posts` | トップページ、全投稿/自分の投稿切り替え |
| 投稿詳細 | `/posts/:id` | 投稿内容、達成ボタン、コメント |
| 新規投稿 | `/posts/new` | きっかけ・アクションプラン入力 |
| 投稿編集 | `/posts/:id/edit` | 投稿内容の編集 |

### ユーザー系

| 画面名 | パス | 説明 |
|--------|------|------|
| マイページ | `/users/:id` | プロフィール、投稿一覧、実績 |
| プロフィール編集 | `/users/:id/edit` | 名前、アバター編集 |

### 静的ページ

| 画面名 | パス | 説明 |
|--------|------|------|
| About | `/about` | サービス説明 |
| 利用規約 | `/terms` | 利用規約 |
| プライバシーポリシー | `/privacy` | プライバシーポリシー |

## ナビゲーション構造

### ヘッダー（共通）

```
┌─────────────────────────────────────────────────────┐
│ [Logo]              [検索]    [通知] [+新規] [User] │
└─────────────────────────────────────────────────────┘
```

- **Logo**: トップページへ遷移
- **検索**: 検索モーダル表示
- **通知**: 通知一覧（将来実装）
- **+新規**: 新規投稿画面へ
- **User**: ドロップダウンメニュー
  - マイページ
  - プロフィール編集
  - ログアウト

### タブナビゲーション（投稿一覧）

```
┌─────────────────────────────────────┐
│   [全体]    [自分の投稿]            │
│   ━━━━━━                            │
└─────────────────────────────────────┘
```

### カテゴリフィルター

```
┌─────────────────────────────────────────────────────┐
│ [全て] [📝] [🎥] [🎧] [💬] [✨] [👀] [📁]           │
└─────────────────────────────────────────────────────┘
```

## 画面遷移パターン

### 通常遷移

```ruby
# リダイレクト
redirect_to posts_path
redirect_to @post

# render
render :new
render :edit
```

### Turbo Frame遷移

```erb
<%# モーダル内での遷移 %>
<%= link_to '編集', edit_post_path(@post),
    data: { turbo_frame: 'modal' } %>

<%# インライン編集 %>
<%= link_to '編集', edit_post_path(@post),
    data: { turbo_frame: dom_id(@post) } %>
```

### Turbo Stream更新

```erb
<%# 達成ボタンクリック時 %>
<%= turbo_stream.replace dom_id(@post, :achievement_button) do %>
  <%= render 'posts/achievement_button', post: @post %>
<% end %>
```

## 各画面の詳細

### 投稿一覧画面

**URL**: `/posts`

**構成要素**:
1. ヘッダー（共通）
2. タブナビゲーション
3. カテゴリフィルター
4. 投稿カードリスト
5. ページネーション
6. フローティング新規投稿ボタン（モバイル）

**状態管理**:
- `tab`: `all` / `mine`
- `category`: カテゴリフィルター値
- `page`: ページ番号

### 投稿詳細画面

**URL**: `/posts/:id`

**構成要素**:
1. ヘッダー（共通）
2. 投稿カード（拡大版）
   - きっかけ内容
   - アクションプラン
   - カテゴリバッジ
   - 画像（あれば）
3. 達成ボタン（大きめ）
4. いいねボタン・カウント
5. コメントセクション
   - コメントフォーム
   - コメント一覧
6. 関連投稿（将来実装）

### 新規投稿画面

**URL**: `/posts/new`

**構成要素**:
1. ヘッダー（共通）
2. 入力フォーム
   - きっかけテキストエリア（100文字）
   - アクションプランテキストエリア（100文字）
   - カテゴリ選択
   - 画像アップロード（任意）
   - 関連URL（任意）
3. 投稿ボタン

**バリデーション**:
- リアルタイム文字数カウント
- 必須項目チェック
- 画像サイズ・形式チェック

### マイページ

**URL**: `/users/:id`

**構成要素**:
1. ヘッダー（共通）
2. プロフィールセクション
   - アバター
   - 名前
   - 実績サマリー（投稿数、達成数）
3. 投稿一覧タブ
4. 達成履歴タブ（将来実装）

## アクセシビリティ

### キーボード操作

- Tab: フォーカス移動
- Enter: ボタン/リンク実行
- Escape: モーダル閉じる
- 矢印キー: タブ/カテゴリ選択

### ARIA属性

```erb
<%# タブ %>
<div role="tablist">
  <button role="tab" aria-selected="true" aria-controls="all-posts">
    全体
  </button>
  <button role="tab" aria-selected="false" aria-controls="my-posts">
    自分の投稿
  </button>
</div>

<%# モーダル %>
<div role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <h2 id="modal-title">確認</h2>
</div>
```

## レスポンシブ対応

### ブレークポイント

| サイズ | 幅 | 用途 |
|--------|-----|------|
| sm | 640px | モバイル横 |
| md | 768px | タブレット |
| lg | 1024px | デスクトップ |
| xl | 1280px | ワイドデスクトップ |

### モバイル最適化

- ハンバーガーメニュー
- フローティングアクションボタン
- スワイプ操作（将来実装）
- 大きなタップ領域（44px以上）

---

*関連ドキュメント*: `03_api_design.md`, `02_design_system/03_components.md`

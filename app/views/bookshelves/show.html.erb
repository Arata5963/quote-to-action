<div class="max-w-6xl mx-auto px-4 py-8">
  <%# ヘッダー %>
  <header class="mb-6">
    <h1 class="text-2xl font-bold text-primary flex items-center gap-2">
      <span>🎬</span>
      <% if @is_own_page %>
        マイフィルム
      <% else %>
        <%= @user.name %>さんのフィルム
      <% end %>
    </h1>
    <p class="text-sm text-primary/60 mt-2">
      総達成数: <%= @total_count %>本
    </p>
  </header>

  <%# 月切り替えUI %>
  <div class="film-month-nav">
    <% prev_month = @current_date.prev_month %>
    <% next_month = @current_date.next_month %>

    <%= link_to bookshelf_path(year: prev_month.year, month: prev_month.month),
          class: "film-month-btn" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    <% end %>

    <span class="film-month-label">
      <%= @current_date.strftime('%Y年%-m月') %>
    </span>

    <% if next_month <= Date.current %>
      <%= link_to bookshelf_path(year: next_month.year, month: next_month.month),
            class: "film-month-btn" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      <% end %>
    <% else %>
      <span class="film-month-btn film-month-btn--disabled">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </span>
    <% end %>
  </div>

  <%# 日付別フィルム表示 %>
  <% frames_per_day = 6 %>
  <div class="film-calendar">
    <% @dates.each do |date| %>
      <% posts = @posts_by_date[date] || [] %>
      <% has_posts = posts.any? %>
      <% empty_frames_count = [frames_per_day - posts.size, 0].max %>

      <div class="film-day <%= 'film-day--empty' unless has_posts %>">
        <%# 日付ラベル %>
        <div class="film-day-label">
          <span class="film-day-date"><%= date.day %></span>
          <span class="film-day-weekday"><%= %w[日 月 火 水 木 金 土][date.wday] %></span>
        </div>

        <%# フィルムストリップ %>
        <div class="film-day-strip">
          <div class="filmstrip-mini">
            <div class="filmstrip-mini-perf"></div>
            <div class="filmstrip-mini-frames">
              <%# サムネイル表示 %>
              <% posts.first(frames_per_day).each do |post| %>
                <%= link_to post_path(post), class: "filmstrip-mini-frame" do %>
                  <%= image_tag post.youtube_thumbnail_url(size: :mqdefault),
                        alt: post.youtube_title || post.action_plan,
                        class: "filmstrip-mini-image",
                        loading: "lazy" %>
                <% end %>
              <% end %>
              <%# 空のコマで残りを埋める %>
              <% empty_frames_count.times do %>
                <div class="filmstrip-mini-frame filmstrip-mini-frame--empty"></div>
              <% end %>
              <%# 6コマ以上ある場合はスクロールで表示 %>
              <% if posts.size > frames_per_day %>
                <% posts.drop(frames_per_day).each do |post| %>
                  <%= link_to post_path(post), class: "filmstrip-mini-frame" do %>
                    <%= image_tag post.youtube_thumbnail_url(size: :mqdefault),
                          alt: post.youtube_title || post.action_plan,
                          class: "filmstrip-mini-image",
                          loading: "lazy" %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
            <div class="filmstrip-mini-perf"></div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <%# 達成がない月 %>
  <% if @posts_by_date.empty? %>
    <div class="text-center mt-8">
      <p class="text-primary/60 mb-4">この月はまだ達成がありません</p>
      <%= link_to "投稿一覧を見る", posts_path,
            class: "inline-block rounded-xl bg-accent text-white px-6 py-3 text-sm font-medium hover:bg-accent/90 transition-colors" %>
    </div>
  <% end %>
</div>

<%# app/views/post_entries/_entry_card.html.erb %>
<%# „Ç®„É≥„Éà„É™„Éº„Ç´„Éº„ÉâÔºànote.comÈ¢®„ÇØ„É™„Éº„É≥„Çπ„Çø„Ç§„É´Ôºâ %>

<div id="<%= dom_id(entry) %>" class="group">
  <div class="flex gap-4">
    <%# Â∑¶: „Çø„Ç§„Éó„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº %>
    <div class="flex-shrink-0 pt-1">
      <% if entry.key_point? %>
        <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center" title="Ë¶ÅÁ¥Ñ">
          <span class="text-lg">üìù</span>
        </div>
      <% elsif entry.quote? %>
        <div class="w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center" title="ÂºïÁî®">
          <span class="text-lg">üí¨</span>
        </div>
      <% elsif entry.action? %>
        <div class="w-8 h-8 rounded-full <%= entry.achieved? ? 'bg-green-50' : 'bg-orange-50' %> flex items-center justify-center" title="„Ç¢„ÇØ„Ç∑„Éß„É≥">
          <span class="text-lg">üéØ</span>
        </div>
      <% end %>
    </div>

    <%# ‰∏≠Â§Æ: „Ç≥„É≥„ÉÜ„É≥„ÉÑ %>
    <div class="flex-1 min-w-0 pb-4 border-b border-gray-100 group-last:border-0 group-last:pb-0">
      <%# „Çø„Ç§„Éó„É©„Éô„É´ + ÊôÇÈñì %>
      <div class="flex items-center gap-2 mb-1">
        <%
          label_class = if entry.key_point?
            'text-blue-600'
          elsif entry.quote?
            'text-purple-600'
          elsif entry.action?
            entry.achieved? ? 'text-green-600' : 'text-orange-600'
          else
            'text-gray-500'
          end

          label_text = if entry.key_point?
            'Ë¶ÅÁ¥Ñ'
          elsif entry.quote?
            'ÂºïÁî®'
          elsif entry.action?
            entry.achieved? ? 'ÈÅîÊàê' : '„Ç¢„ÇØ„Ç∑„Éß„É≥'
          else
            ''
          end
        %>
        <span class="text-xs font-medium <%= label_class %>"><%= label_text %></span>
        <span class="text-xs text-gray-400"><%= time_ago_in_words(entry.created_at) %>Ââç</span>
      </div>

      <%# „Ç≥„É≥„ÉÜ„É≥„ÉÑÊú¨Êñá %>
      <% if entry.content.present? %>
        <p class="text-gray-800 text-[15px] leading-relaxed whitespace-pre-line"><%= entry.content %></p>
      <% else %>
        <p class="text-gray-400 text-sm italic">ÂÜÖÂÆπ„Å™„Åó</p>
      <% end %>

      <%# „É°„ÇøÊÉÖÂ†± %>
      <div class="mt-2 flex items-center gap-3 flex-wrap">
        <%# ÊúüÊó•Ë°®Á§∫ÔºàÊú™ÈÅîÊàê„ÅÆaction„ÅÆ„ÅøÔºâ %>
        <% if entry.action? && entry.deadline && !entry.achieved? %>
          <span class="inline-flex items-center gap-1 text-xs <%= entry.deadline < Date.current ? 'text-red-500' : 'text-orange-500' %>">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <%= l(entry.deadline, format: :short) %>
            <% if entry.deadline < Date.current %>
              <span class="text-red-500">(Ë∂ÖÈÅé)</span>
            <% elsif entry.deadline <= Date.current + 3.days %>
              <span>(„ÅÇ„Å®<%= (entry.deadline - Date.current).to_i %>Êó•)</span>
            <% end %>
          </span>
        <% end %>

        <%# Ê∫ÄË∂≥Â∫¶ %>
        <% if entry.satisfaction_rating.present? %>
          <span class="inline-flex items-center gap-0.5 text-xs text-yellow-500" title="<%= entry.satisfaction_label %>">
            <% entry.satisfaction_rating.times do %>
              <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
              </svg>
            <% end %>
          </span>
        <% end %>
      </div>
    </div>

    <%# Âè≥: „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÔºàaction„Çø„Ç§„Éó„ÅÆ„ÅøÔºâ %>
    <% if entry.action? %>
      <div class="flex-shrink-0 pt-1">
        <% if entry.achieved? %>
          <%# ÈÅîÊàêÊ∏à„Åø %>
          <div class="w-6 h-6 rounded-full flex items-center justify-center" style="background-color: #22c55e;" title="ÈÅîÊàêÊ∏à„Åø">
            <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          </div>
        <% elsif user_signed_in? && entry.post.user == current_user %>
          <%# Êú™ÈÅîÊàêÔºàÊú¨‰∫∫Ôºâ %>
          <%= button_to achieve_post_post_entry_path(entry.post, entry),
                method: :patch,
                class: "w-6 h-6 flex items-center justify-center rounded-full border-2 border-gray-300 bg-white hover:border-green-500 hover:bg-green-50 transition-colors cursor-pointer",
                title: "ÈÅîÊàê„Å´„Åô„Çã",
                data: { turbo_frame: "_top" } do %>
          <% end %>
        <% else %>
          <%# Êú™ÈÅîÊàêÔºà‰ªñ‰∫∫Ôºâ %>
          <div class="w-6 h-6 rounded-full border-2 border-gray-200" title="Êú™ÈÅîÊàê"></div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

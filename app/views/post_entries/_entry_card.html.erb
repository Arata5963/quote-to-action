<%# app/views/post_entries/_entry_card.html.erb %>
<%# „Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥„Ç´„Éº„Éâ %>

<div id="<%= dom_id(entry) %>" class="group">
  <div class="flex gap-4">
    <%# Â∑¶: „Ç¢„Ç§„Ç≥„É≥ %>
    <div class="flex-shrink-0 pt-1">
      <div class="w-8 h-8 rounded-full <%= entry.achieved? ? 'bg-green-50' : 'bg-orange-50' %> flex items-center justify-center">
        <span class="text-lg">üéØ</span>
      </div>
    </div>

    <%# ‰∏≠Â§Æ: „Ç≥„É≥„ÉÜ„É≥„ÉÑ %>
    <div class="flex-1 min-w-0 pb-4 border-b border-gray-100 group-last:border-0 group-last:pb-0">
      <%# „É¶„Éº„Ç∂„ÉºÊÉÖÂ†± + ÊôÇÈñì %>
      <div class="flex items-center gap-2 mb-1">
        <% if entry.display_anonymous? %>
          <span class="text-xs text-gray-500">ÂåøÂêç</span>
        <% else %>
          <span class="text-xs text-gray-700 font-medium"><%= entry.display_user_name %></span>
        <% end %>
        <span class="text-xs <%= entry.achieved? ? 'text-green-600' : 'text-orange-600' %> font-medium">
          <%= entry.achieved? ? 'ÈÅîÊàê' : '„Ç¢„ÇØ„Ç∑„Éß„É≥„Éó„É©„É≥' %>
        </span>
        <span class="text-xs text-gray-400"><%= time_ago_in_words(entry.created_at) %>Ââç</span>
      </div>

      <%# „Ç≥„É≥„ÉÜ„É≥„ÉÑÊú¨Êñá %>
      <p class="text-gray-800 text-[15px] leading-relaxed whitespace-pre-line <%= 'line-through text-gray-400' if entry.achieved? %>">
        <%= entry.content %>
      </p>

      <%# ÊúüÊó•Ë°®Á§∫ÔºàÊú™ÈÅîÊàê„ÅÆ„ÅøÔºâ %>
      <% if entry.deadline && !entry.achieved? %>
        <div class="mt-2">
          <span class="inline-flex items-center gap-1 text-xs <%= entry.deadline < Date.current ? 'text-red-500' : 'text-orange-500' %>">
            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <%= l(entry.deadline, format: :short) %>
            <% if entry.deadline < Date.current %>
              <span class="text-red-500">(Ë∂ÖÈÅé)</span>
            <% elsif entry.deadline <= Date.current + 3.days %>
              <span>(„ÅÇ„Å®<%= (entry.deadline - Date.current).to_i %>Êó•)</span>
            <% end %>
          </span>
        </div>
      <% end %>
    </div>

    <%# Âè≥: „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ %>
    <div class="flex-shrink-0 pt-1">
      <% if entry.achieved? %>
        <%# ÈÅîÊàêÊ∏à„Åø %>
        <% if user_signed_in? && entry.user == current_user %>
          <%= button_to achieve_post_post_entry_path(entry.post, entry),
                method: :patch,
                class: "w-6 h-6 rounded-full flex items-center justify-center cursor-pointer",
                style: "background-color: #22c55e;",
                title: "Êú™ÈÅîÊàê„Å´Êàª„Åô" do %>
            <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          <% end %>
        <% else %>
          <div class="w-6 h-6 rounded-full flex items-center justify-center" style="background-color: #22c55e;" title="ÈÅîÊàêÊ∏à„Åø">
            <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
            </svg>
          </div>
        <% end %>
      <% elsif user_signed_in? && entry.user == current_user %>
        <%# Êú™ÈÅîÊàêÔºàÊú¨‰∫∫Ôºâ %>
        <%= button_to achieve_post_post_entry_path(entry.post, entry),
              method: :patch,
              class: "w-6 h-6 flex items-center justify-center rounded-full border-2 border-gray-300 bg-white hover:border-green-500 hover:bg-green-50 transition-colors cursor-pointer",
              title: "ÈÅîÊàê„Å´„Åô„Çã" do %>
        <% end %>
      <% else %>
        <%# Êú™ÈÅîÊàêÔºà‰ªñ‰∫∫Ôºâ %>
        <div class="w-6 h-6 rounded-full border-2 border-gray-200" title="Êú™ÈÅîÊàê"></div>
      <% end %>
    </div>
  </div>
</div>

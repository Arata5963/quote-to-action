<%# app/views/post_entries/_blog_form.html.erb %>
<%# ブログエディタ（Zenn風2カラム） %>

<% entry ||= PostEntry.new(entry_type: :blog) %>
<% is_edit = entry.persisted? %>

<div class="blog-editor">
  <%= form_with model: [post, entry], url: is_edit ? post_post_entry_path(post, entry) : post_post_entries_path(post), method: is_edit ? :patch : :post, local: true, data: { controller: "markdown-preview" } do |f| %>
    <%= f.hidden_field :entry_type, value: "blog" %>

    <%# ヘッダー %>
    <div class="blog-editor-header">
      <div class="flex items-center gap-3">
        <%= link_to post_path(post), class: "flex items-center gap-2 text-gray-500 hover:text-gray-700 transition-colors" do %>
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
          </svg>
          <span class="text-sm">戻る</span>
        <% end %>

        <% if entry.persisted? %>
          <% if entry.draft? %>
            <span class="blog-draft-badge">
              <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
              </svg>
              下書き
            </span>
          <% else %>
            <span class="blog-published-badge">
              <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
              </svg>
              公開済み
            </span>
          <% end %>
        <% end %>
      </div>

      <div class="blog-editor-actions">
        <%= f.submit "下書き保存", name: "draft", class: "blog-editor-btn blog-editor-btn-draft" %>
        <%= f.submit entry.published? ? "更新する" : "公開する", name: "publish", class: "blog-editor-btn blog-editor-btn-publish" %>
      </div>
    </div>

    <%# メインエリア %>
    <div class="blog-editor-main">
      <div style="width: 100%;">
        <%# タイトル %>
        <%= f.text_field :title,
              placeholder: "タイトルを入力...",
              class: "blog-title-input",
              autofocus: !is_edit %>

        <%# 2カラムエディタ %>
        <div class="blog-editor-columns">
          <%# 左: Markdown入力 %>
          <div class="blog-editor-column">
            <div class="blog-editor-column-label">
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
              Markdown
            </div>
            <%= f.text_area :content,
                  placeholder: "# 見出し\n\n本文を書く...\n\n## 小見出し\n\n- リスト1\n- リスト2\n\n> 引用文\n\n**太字** や *斜体* も使えます",
                  class: "blog-content-textarea",
                  data: { markdown_preview_target: "input", action: "input->markdown-preview#update" } %>
          </div>

          <%# 右: プレビュー %>
          <div class="blog-editor-column">
            <div class="blog-editor-column-label">
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
              プレビュー
            </div>
            <div class="blog-preview" data-markdown-preview-target="preview"></div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

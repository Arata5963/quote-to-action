<%# app/views/post_entries/_entry_card.html.erb %>
<%# 案8: タイムライン風 - 縦のラインで繋がるデザイン %>

<div id="<%= dom_id(entry) %>" style="display: flex; gap: 16px; padding: 0 12px; position: relative;">
  <%# 左側：タイムライン %>
  <div style="flex-shrink: 0; display: flex; flex-direction: column; align-items: center; width: 44px;">
    <%# 上のライン %>
    <div style="width: 2px; height: 16px; background: #e2e8f0;"></div>

    <%# アバター/ノード %>
    <div style="position: relative; z-index: 1;">
      <% if entry.display_anonymous? %>
        <div style="width: 44px; height: 44px; border-radius: 50%; background: white; border: 3px solid <%= entry.achieved? ? '#22c55e' : '#6366f1' %>; display: flex; align-items: center; justify-content: center;">
          <svg style="width: 20px; height: 20px; color: <%= entry.achieved? ? '#22c55e' : '#6366f1' %>;" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
        </div>
      <% elsif entry.display_avatar.present? %>
        <%= image_tag entry.display_avatar.url, style: "width: 44px; height: 44px; border-radius: 50%; object-fit: cover; border: 3px solid #{entry.achieved? ? '#22c55e' : '#6366f1'};" %>
      <% else %>
        <div style="width: 44px; height: 44px; border-radius: 50%; background: <%= entry.achieved? ? '#22c55e' : '#6366f1' %>; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px;">
          <%= entry.display_user_name&.first&.upcase || '?' %>
        </div>
      <% end %>
      <% if entry.achieved? %>
        <div style="position: absolute; bottom: -2px; right: -2px; width: 18px; height: 18px; background: #22c55e; border-radius: 50%; border: 2px solid white; display: flex; align-items: center; justify-content: center;">
          <svg style="width: 10px; height: 10px; color: white;" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
        </div>
      <% end %>
    </div>

    <%# 下のライン %>
    <div style="width: 2px; flex: 1; min-height: 20px; background: #e2e8f0;"></div>
  </div>

  <%# 右側：コンテンツ %>
  <div style="flex: 1; min-width: 0; padding: 12px 0 24px 0;">
    <%# ヘッダー %>
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-weight: 700; font-size: 14px; color: #1e293b;"><%= entry.display_anonymous? ? '匿名' : entry.display_user_name %></span>
        <% if entry.deadline.present? %>
          <span style="font-size: 12px; color: <%= entry.deadline < Date.current && !entry.achieved? ? '#ef4444' : '#94a3b8' %>;">
            <%= entry.deadline < Date.current && !entry.achieved? ? '期限超過' : l(entry.deadline, format: :short) %>
          </span>
        <% end %>
      </div>
      <% if user_signed_in? && entry.user == current_user %>
        <details style="position: relative;">
          <summary style="list-style: none; cursor: pointer; padding: 4px; opacity: 0.4; transition: opacity 0.15s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.4'">
            <svg style="width: 16px; height: 16px; color: #64748b;" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
          </summary>
          <div style="position: absolute; right: 0; top: 100%; margin-top: 4px; background: white; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.12); border: 1px solid #e2e8f0; z-index: 10; overflow: hidden;">
            <%= button_to post_post_entry_path(entry.post, entry), method: :delete, data: { turbo_confirm: "削除しますか？" }, style: "font-size: 13px; color: #ef4444; background: none; border: none; cursor: pointer; padding: 8px 16px; white-space: nowrap;" do %>削除<% end %>
          </div>
        </details>
      <% end %>
    </div>

    <%# カード %>
    <div style="background: <%= entry.achieved? ? '#f0fdf4' : '#f8fafc' %>; border-radius: 12px; padding: 14px 16px; border: 1px solid <%= entry.achieved? ? '#bbf7d0' : '#e2e8f0' %>;">
      <p style="font-size: 15px; line-height: 1.6; color: <%= entry.achieved? ? '#166534' : '#334155' %>; margin: 0; <%= 'text-decoration: line-through; opacity: 0.7;' if entry.achieved? %>"><%= entry.content %></p>

      <% if user_signed_in? && entry.user == current_user %>
        <div style="margin-top: 12px; text-align: right;">
          <%= form_with url: achieve_post_post_entry_path(entry.post, entry), method: :patch, style: "display: inline;" do %>
            <button type="submit" style="font-size: 12px; font-weight: 600; color: <%= entry.achieved? ? '#64748b' : '#6366f1' %>; background: white; border: 1px solid <%= entry.achieved? ? '#e2e8f0' : '#6366f1' %>; cursor: pointer; padding: 5px 14px; border-radius: 6px; transition: all 0.15s;" onmouseover="this.style.background='<%= entry.achieved? ? '#f1f5f9' : '#6366f1' %>'; this.style.color='<%= entry.achieved? ? '#64748b' : 'white' %>'" onmouseout="this.style.background='white'; this.style.color='<%= entry.achieved? ? '#64748b' : '#6366f1' %>'">
              <%= entry.achieved? ? '戻す' : '達成にする' %>
            </button>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

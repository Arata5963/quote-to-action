<%# app/views/post_entries/_entry_card.html.erb %>
<%# æ¡ˆ5: ãƒãƒƒãƒ—ã‚«ãƒ¼ãƒ‰é¢¨ - ã‚«ãƒ©ãƒ•ãƒ«ã§ãƒãƒƒãƒ—ã€æµ®ãå‡ºã‚‹ã‚«ãƒ¼ãƒ‰ %>

<div id="<%= dom_id(entry) %>" style="display: flex; gap: 12px; padding: 12px; align-items: flex-start; transition: transform 0.2s;" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='translateX(0)'">
  <%# ã‚¢ãƒã‚¿ãƒ¼ï¼ˆã‚«ãƒ©ãƒ•ãƒ«ãƒœãƒ¼ãƒ€ãƒ¼ï¼‰ %>
  <div style="flex-shrink: 0; position: relative;">
    <div style="position: absolute; inset: -3px; border-radius: 50%; background: <%= entry.achieved? ? 'linear-gradient(135deg, #22c55e, #16a34a)' : 'linear-gradient(135deg, #f472b6, #8b5cf6, #3b82f6)' %>;"></div>
    <% if entry.display_anonymous? %>
      <div style="position: relative; width: 44px; height: 44px; border-radius: 50%; background: #f1f5f9; display: flex; align-items: center; justify-content: center; border: 2px solid white;">
        <svg style="width: 22px; height: 22px; color: #94a3b8;" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
    <% elsif entry.display_avatar.present? %>
      <%= image_tag entry.display_avatar.url, style: "position: relative; width: 44px; height: 44px; border-radius: 50%; object-fit: cover; border: 2px solid white;" %>
    <% else %>
      <div style="position: relative; width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px; border: 2px solid white;">
        <%= entry.display_user_name&.first&.upcase || '?' %>
      </div>
    <% end %>
  </div>

  <%# ã‚«ãƒ¼ãƒ‰æœ¬ä½“ %>
  <div style="flex: 1; min-width: 0;">
    <%# å¹ãå‡ºã—ã‚«ãƒ¼ãƒ‰ %>
    <div style="position: relative; background: white; border-radius: 16px; padding: 12px 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.08), 0 0 0 1px rgba(0,0,0,0.04); border-left: 4px solid <%= entry.achieved? ? '#22c55e' : '#8b5cf6' %>;">
      <%# ã—ã£ã½ %>
      <div style="position: absolute; left: -12px; top: 14px; width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-right: 8px solid <%= entry.achieved? ? '#22c55e' : '#8b5cf6' %>;"></div>

      <%# ãƒ˜ãƒƒãƒ€ãƒ¼ %>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-weight: 700; font-size: 14px; color: #1e293b;"><%= entry.display_anonymous? ? 'åŒ¿å' : entry.display_user_name %></span>
          <% if entry.achieved? %>
            <span style="font-size: 10px; font-weight: 700; color: white; background: linear-gradient(135deg, #22c55e, #16a34a); padding: 2px 8px; border-radius: 10px;">DONE!</span>
          <% end %>
        </div>
        <% if user_signed_in? && entry.user == current_user %>
          <details style="position: relative;">
            <summary style="list-style: none; cursor: pointer; padding: 4px; opacity: 0.4; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.4'">
              <svg style="width: 16px; height: 16px; color: #94a3b8;" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
            </summary>
            <div style="position: absolute; right: 0; top: 100%; margin-top: 4px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 10; overflow: hidden;">
              <%= button_to post_post_entry_path(entry.post, entry), method: :delete, data: { turbo_confirm: "å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" }, style: "font-size: 13px; color: #ef4444; background: none; border: none; cursor: pointer; padding: 10px 20px; white-space: nowrap;" do %>å‰Šé™¤<% end %>
            </div>
          </details>
        <% end %>
      </div>

      <%# æœ¬æ–‡ %>
      <p style="font-size: 15px; line-height: 1.6; color: <%= entry.achieved? ? '#16a34a' : '#334155' %>; margin: 0; <%= 'text-decoration: line-through; opacity: 0.6;' if entry.achieved? %>"><%= entry.content %></p>

      <%# ãƒ•ãƒƒã‚¿ãƒ¼ %>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;">
        <% if entry.deadline.present? %>
          <span style="font-size: 11px; font-weight: 500; color: <%= entry.deadline < Date.current && !entry.achieved? ? '#ef4444' : '#94a3b8' %>; background: <%= entry.deadline < Date.current && !entry.achieved? ? '#fef2f2' : '#f8fafc' %>; padding: 3px 8px; border-radius: 6px;">
            <%= entry.deadline < Date.current && !entry.achieved? ? 'âš ï¸ æœŸé™è¶…éŽ' : "ðŸ“… #{l(entry.deadline, format: :short)}" %>
          </span>
        <% else %>
          <span></span>
        <% end %>

        <% if user_signed_in? && entry.user == current_user %>
          <%= form_with url: achieve_post_post_entry_path(entry.post, entry), method: :patch, style: "display: inline;" do %>
            <button type="submit" style="font-size: 12px; font-weight: 700; color: white; background: <%= entry.achieved? ? '#94a3b8' : 'linear-gradient(135deg, #f472b6, #8b5cf6)' %>; border: none; cursor: pointer; padding: 6px 14px; border-radius: 20px; transition: transform 0.15s, box-shadow 0.15s;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(139,92,246,0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'">
              <%= entry.achieved? ? 'æˆ»ã™' : 'ðŸŽ¯ é”æˆï¼' %>
            </button>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>

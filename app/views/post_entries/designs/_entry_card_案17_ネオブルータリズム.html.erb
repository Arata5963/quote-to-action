<%# app/views/post_entries/_entry_card.html.erb %>
<%# æ¡ˆ17: ãƒã‚ªãƒ–ãƒ«ãƒ¼ã‚¿ãƒªã‚ºãƒ  - å¤ªã„é»’æž ã€ãƒ“ãƒ“ãƒƒãƒ‰ã‚«ãƒ©ãƒ¼ã€ã‚ºãƒ¬ãŸå½± %>

<div id="<%= dom_id(entry) %>" style="display: flex; gap: 12px; padding: 12px; align-items: flex-start;">

  <%# ã‚¢ãƒã‚¿ãƒ¼ï¼ˆå¤ªæž ï¼‰ %>
  <div style="flex-shrink: 0; position: relative;">
    <% if entry.display_anonymous? %>
      <div style="width: 44px; height: 44px; border-radius: 12px; background: #e5e5e5; border: 3px solid #000; box-shadow: 4px 4px 0 #000; display: flex; align-items: center; justify-content: center;">
        <svg style="width: 22px; height: 22px; color: #666;" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
    <% elsif entry.display_avatar.present? %>
      <%= image_tag entry.display_avatar.url, style: "width: 44px; height: 44px; border-radius: 12px; object-fit: cover; border: 3px solid #000; box-shadow: 4px 4px 0 #000;" %>
    <% else %>
      <div style="width: 44px; height: 44px; border-radius: 12px; background: <%= ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da'][entry.id % 6] %>; border: 3px solid #000; box-shadow: 4px 4px 0 #000; display: flex; align-items: center; justify-content: center; color: #000; font-weight: 900; font-size: 18px;">
        <%= entry.display_user_name&.first&.upcase || '?' %>
      </div>
    <% end %>

    <% if entry.achieved? %>
      <div style="position: absolute; bottom: -4px; right: -4px; width: 20px; height: 20px; background: #00ff88; border: 2px solid #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 2px 2px 0 #000;">
        <svg style="width: 10px; height: 10px; color: #000;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><path d="M5 12l5 5L20 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
    <% end %>
  </div>

  <%# ã‚«ãƒ¼ãƒ‰ %>
  <div style="flex: 1; min-width: 0;">
    <div style="background: <%= entry.achieved? ? '#00ff88' : '#fff' %>; border: 3px solid #000; border-radius: 16px; padding: 14px 16px; box-shadow: 6px 6px 0 #000; position: relative;">

      <%# é”æˆã‚¹ã‚¿ãƒ³ãƒ— %>
      <% if entry.achieved? %>
        <div style="position: absolute; top: -8px; right: 12px; background: #000; color: #00ff88; font-size: 10px; font-weight: 900; padding: 4px 10px; border-radius: 4px; transform: rotate(3deg);">DONE!</div>
      <% end %>

      <%# ãƒ˜ãƒƒãƒ€ãƒ¼ %>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; gap: 8px;">
        <span style="font-weight: 900; font-size: 14px; color: #000; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><%= entry.display_anonymous? ? 'åŒ¿å' : entry.display_user_name %></span>

        <div style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
          <% if entry.deadline.present? %>
            <% deadline_overdue = entry.deadline < Date.current && !entry.achieved? %>
            <span style="font-size: 11px; font-weight: 800; color: #000; background: <%= deadline_overdue ? '#ff6b6b' : '#ffe66d' %>; padding: 4px 10px; border-radius: 6px; border: 2px solid #000;">
              <%= deadline_overdue ? 'âš ï¸ è¶…éŽ' : "ðŸ“… #{l(entry.deadline, format: :short)}" %>
            </span>
          <% end %>

          <% if user_signed_in? && entry.user == current_user %>
            <details style="position: relative;">
              <summary style="list-style: none; cursor: pointer; padding: 6px; margin: -6px; font-weight: 900; font-size: 16px;">â‹®</summary>
              <div style="position: absolute; right: 0; top: 100%; margin-top: 4px; background: #fff; border: 3px solid #000; border-radius: 8px; box-shadow: 4px 4px 0 #000; z-index: 10; overflow: hidden;">
                <%= button_to post_post_entry_path(entry.post, entry), method: :delete, data: { turbo_confirm: "å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" }, style: "font-size: 13px; font-weight: 700; color: #000; background: #ff6b6b; border: none; cursor: pointer; padding: 10px 16px; white-space: nowrap;" do %>å‰Šé™¤<% end %>
              </div>
            </details>
          <% end %>
        </div>
      </div>

      <%# æœ¬æ–‡ %>
      <div style="display: flex; align-items: flex-start; gap: 10px;">
        <% if user_signed_in? && entry.user == current_user %>
          <%= form_with url: achieve_post_post_entry_path(entry.post, entry), method: :patch, style: "flex-shrink: 0; margin-top: 2px;" do %>
            <button type="submit" style="width: 26px; height: 26px; border-radius: 50%; border: 3px solid #000; background: <%= entry.achieved? ? '#000' : '#fff' %>; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; box-shadow: 2px 2px 0 <%= entry.achieved? ? '#00ff88' : '#000' %>; transition: transform 0.1s;" onmouseover="this.style.transform='translate(-2px,-2px)'" onmouseout="this.style.transform='translate(0,0)'">
              <% if entry.achieved? %>
                <svg style="width: 14px; height: 14px; color: #00ff88;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4"><path d="M5 12l5 5L20 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <% end %>
            </button>
          <% end %>
        <% end %>
        <p style="flex: 1; font-size: 15px; font-weight: 600; line-height: 1.6; color: #000; margin: 0; word-break: break-word; <%= 'text-decoration: line-through;' if entry.achieved? %>"><%= entry.content %></p>
      </div>
    </div>
  </div>
</div>

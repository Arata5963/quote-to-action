<%# app/views/post_entries/_entry_card.html.erb %>
<%# 案18: パステルドリーム - 柔らかいパステル、ふわふわした雰囲気 %>

<div id="<%= dom_id(entry) %>" style="display: flex; gap: 10px; padding: 12px; align-items: flex-start;">

  <%# アバター（パステルグラデーション） %>
  <div style="flex-shrink: 0; position: relative;">
    <% pastel_colors = ['linear-gradient(135deg, #ffecd2, #fcb69f)', 'linear-gradient(135deg, #a1c4fd, #c2e9fb)', 'linear-gradient(135deg, #d299c2, #fef9d7)', 'linear-gradient(135deg, #89f7fe, #66a6ff)', 'linear-gradient(135deg, #fddb92, #d1fdff)', 'linear-gradient(135deg, #f6d365, #fda085)'] %>

    <% if entry.display_anonymous? %>
      <div style="width: 42px; height: 42px; border-radius: 50%; background: linear-gradient(135deg, #e0e0e0, #f5f5f5); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08);">
        <svg style="width: 20px; height: 20px; color: #bbb;" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
    <% elsif entry.display_avatar.present? %>
      <%= image_tag entry.display_avatar.url, style: "width: 42px; height: 42px; border-radius: 50%; object-fit: cover; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 3px solid white;" %>
    <% else %>
      <div style="width: 42px; height: 42px; border-radius: 50%; background: <%= pastel_colors[entry.id % 6] %>; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-shadow: 0 1px 2px rgba(0,0,0,0.1);">
        <%= entry.display_user_name&.first&.upcase || '?' %>
      </div>
    <% end %>

    <% if entry.achieved? %>
      <div style="position: absolute; bottom: -2px; right: -2px; width: 18px; height: 18px; background: linear-gradient(135deg, #a8edea, #fed6e3); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <svg style="width: 10px; height: 10px; color: #ff9a9e;" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      </div>
    <% end %>
  </div>

  <%# ふわふわカード %>
  <div style="flex: 1; min-width: 0;">
    <div style="background: <%= entry.achieved? ? 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #ffecd2 100%)' : 'linear-gradient(135deg, #fdfbfb 0%, #ebedee 50%, #fdfbfb 100%)' %>; border-radius: 24px; padding: 16px 18px; box-shadow: 0 8px 30px rgba(0,0,0,0.06), 0 2px 8px rgba(0,0,0,0.04); position: relative; overflow: hidden;">

      <%# 装飾：ふわふわ雲 %>
      <div style="position: absolute; top: -20px; right: -10px; width: 60px; height: 60px; background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%); border-radius: 50%; pointer-events: none;"></div>
      <div style="position: absolute; bottom: -15px; left: 20px; width: 40px; height: 40px; background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, transparent 70%); border-radius: 50%; pointer-events: none;"></div>

      <%# 達成リボン %>
      <% if entry.achieved? %>
        <div style="position: absolute; top: 12px; right: -28px; background: linear-gradient(135deg, #ff9a9e, #fecfef); color: white; font-size: 9px; font-weight: 700; padding: 4px 30px; transform: rotate(45deg); box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-shadow: 0 1px 1px rgba(0,0,0,0.1);">DONE</div>
      <% end %>

      <%# ヘッダー %>
      <div style="position: relative; display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; gap: 8px;">
        <span style="font-weight: 600; font-size: 13px; color: <%= entry.achieved? ? '#c44569' : '#7f8c8d' %>; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><%= entry.display_anonymous? ? '匿名さん' : entry.display_user_name %></span>

        <div style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
          <% if entry.deadline.present? %>
            <% deadline_overdue = entry.deadline < Date.current && !entry.achieved? %>
            <span style="font-size: 10px; font-weight: 500; color: <%= deadline_overdue ? '#e17055' : '#a29bfe' %>; background: <%= deadline_overdue ? 'rgba(225,112,85,0.15)' : 'rgba(162,155,254,0.15)' %>; padding: 4px 10px; border-radius: 20px;">
              <%= deadline_overdue ? '期限過ぎちゃった' : "#{l(entry.deadline, format: :short)}まで" %>
            </span>
          <% end %>

          <% if user_signed_in? && entry.user == current_user %>
            <details style="position: relative;">
              <summary style="list-style: none; cursor: pointer; padding: 8px; margin: -8px; opacity: 0.5;">
                <svg style="width: 14px; height: 14px; color: #bdc3c7;" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
              </summary>
              <div style="position: absolute; right: 0; top: 100%; margin-top: 4px; background: white; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.12); z-index: 10; overflow: hidden;">
                <%= button_to post_post_entry_path(entry.post, entry), method: :delete, data: { turbo_confirm: "削除しますか？" }, style: "font-size: 12px; color: #e17055; background: none; border: none; cursor: pointer; padding: 12px 20px; white-space: nowrap;" do %>削除する<% end %>
              </div>
            </details>
          <% end %>
        </div>
      </div>

      <%# 本文 %>
      <div style="position: relative; display: flex; align-items: flex-start; gap: 10px;">
        <% if user_signed_in? && entry.user == current_user %>
          <%= form_with url: achieve_post_post_entry_path(entry.post, entry), method: :patch, style: "flex-shrink: 0; margin-top: 3px;" do %>
            <button type="submit" style="width: 22px; height: 22px; border-radius: 50%; border: none; background: <%= entry.achieved? ? 'linear-gradient(135deg, #ff9a9e, #fecfef)' : 'linear-gradient(135deg, #e0e0e0, #f5f5f5)' %>; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.15)'" onmouseout="this.style.transform='scale(1)'">
              <% if entry.achieved? %>
                <svg style="width: 12px; height: 12px; color: white;" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
              <% end %>
            </button>
          <% end %>
        <% end %>
        <p style="flex: 1; font-size: 14px; line-height: 1.7; color: <%= entry.achieved? ? '#c44569' : '#636e72' %>; margin: 0; word-break: break-word; <%= 'text-decoration: line-through; opacity: 0.6;' if entry.achieved? %>"><%= entry.content %></p>
      </div>
    </div>
  </div>
</div>

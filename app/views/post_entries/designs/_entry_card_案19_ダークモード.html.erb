<%# app/views/post_entries/_entry_card.html.erb %>
<%# 案19: ダークモード - 暗い背景、ネオンアクセント %>

<div id="<%= dom_id(entry) %>" style="display: flex; gap: 10px; padding: 12px; align-items: flex-start;">

  <%# アバター（ネオングロー） %>
  <div style="flex-shrink: 0; position: relative;">
    <% neon_colors = ['#00f5ff', '#ff00ff', '#00ff88', '#ffff00', '#ff6b6b', '#a855f7'] %>
    <% glow_color = entry.achieved? ? '#00ff88' : neon_colors[entry.id % 6] %>

    <%# ネオングロー %>
    <div style="position: absolute; inset: -3px; border-radius: 14px; background: <%= glow_color %>; filter: blur(8px); opacity: 0.6;"></div>

    <% if entry.display_anonymous? %>
      <div style="position: relative; width: 40px; height: 40px; border-radius: 12px; background: #2d2d2d; border: 2px solid #404040; display: flex; align-items: center; justify-content: center;">
        <svg style="width: 20px; height: 20px; color: #666;" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
    <% elsif entry.display_avatar.present? %>
      <%= image_tag entry.display_avatar.url, style: "position: relative; width: 40px; height: 40px; border-radius: 12px; object-fit: cover; border: 2px solid #{glow_color};" %>
    <% else %>
      <div style="position: relative; width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(135deg, #1a1a2e, #16213e); border: 2px solid <%= glow_color %>; display: flex; align-items: center; justify-content: center; color: <%= glow_color %>; font-weight: 700; font-size: 16px; text-shadow: 0 0 10px <%= glow_color %>;">
        <%= entry.display_user_name&.first&.upcase || '?' %>
      </div>
    <% end %>

    <% if entry.achieved? %>
      <div style="position: absolute; bottom: -3px; right: -3px; width: 18px; height: 18px; background: #0a0a0a; border: 2px solid #00ff88; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px #00ff88;">
        <svg style="width: 10px; height: 10px; color: #00ff88;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12l5 5L20 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
    <% end %>
  </div>

  <%# ダークカード %>
  <div style="flex: 1; min-width: 0;">
    <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 16px; padding: 14px 16px; border: 1px solid <%= entry.achieved? ? '#00ff88' : '#2d2d44' %>; box-shadow: <%= entry.achieved? ? '0 0 20px rgba(0,255,136,0.2)' : '0 4px 20px rgba(0,0,0,0.3)' %>; position: relative; overflow: hidden;">

      <%# グリッドライン（サイバー感） %>
      <div style="position: absolute; inset: 0; background-image: linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px); background-size: 20px 20px; pointer-events: none;"></div>

      <%# 達成バッジ %>
      <% if entry.achieved? %>
        <div style="position: absolute; top: 8px; right: 10px; background: transparent; border: 1px solid #00ff88; color: #00ff88; font-size: 9px; font-weight: 700; padding: 3px 8px; border-radius: 4px; text-shadow: 0 0 5px #00ff88; letter-spacing: 1px;">COMPLETE</div>
      <% end %>

      <%# ヘッダー %>
      <div style="position: relative; display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; gap: 8px;">
        <span style="font-weight: 600; font-size: 13px; color: <%= entry.achieved? ? '#00ff88' : '#e0e0e0' %>; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; <%= 'text-shadow: 0 0 8px #00ff88;' if entry.achieved? %>"><%= entry.display_anonymous? ? '匿名' : entry.display_user_name %></span>

        <div style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
          <% if entry.deadline.present? %>
            <% deadline_overdue = entry.deadline < Date.current && !entry.achieved? %>
            <span style="font-size: 10px; font-weight: 500; color: <%= deadline_overdue ? '#ff6b6b' : '#00f5ff' %>; background: rgba(0,0,0,0.3); padding: 4px 10px; border-radius: 4px; border: 1px solid <%= deadline_overdue ? '#ff6b6b' : '#00f5ff' %>; <%= "text-shadow: 0 0 5px #{deadline_overdue ? '#ff6b6b' : '#00f5ff'};" %>">
              <%= deadline_overdue ? 'OVERDUE' : l(entry.deadline, format: :short) %>
            </span>
          <% end %>

          <% if user_signed_in? && entry.user == current_user %>
            <details style="position: relative;">
              <summary style="list-style: none; cursor: pointer; padding: 8px; margin: -8px; opacity: 0.6;">
                <svg style="width: 16px; height: 16px; color: #666;" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
              </summary>
              <div style="position: absolute; right: 0; top: 100%; margin-top: 4px; background: #1a1a2e; border: 1px solid #2d2d44; border-radius: 8px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); z-index: 10; overflow: hidden;">
                <%= button_to post_post_entry_path(entry.post, entry), method: :delete, data: { turbo_confirm: "削除しますか？" }, style: "font-size: 13px; color: #ff6b6b; background: none; border: none; cursor: pointer; padding: 12px 20px; white-space: nowrap;" do %>削除<% end %>
              </div>
            </details>
          <% end %>
        </div>
      </div>

      <%# 本文 %>
      <div style="position: relative; display: flex; align-items: flex-start; gap: 10px;">
        <% if user_signed_in? && entry.user == current_user %>
          <%= form_with url: achieve_post_post_entry_path(entry.post, entry), method: :patch, style: "flex-shrink: 0; margin-top: 2px;" do %>
            <button type="submit" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid <%= entry.achieved? ? '#00ff88' : '#404040' %>; background: <%= entry.achieved? ? 'transparent' : '#0a0a0a' %>; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; box-shadow: <%= entry.achieved? ? '0 0 10px #00ff88, inset 0 0 10px rgba(0,255,136,0.2)' : 'none' %>; transition: all 0.2s;" onmouseover="this.style.borderColor='#00f5ff'; this.style.boxShadow='0 0 10px #00f5ff'" onmouseout="this.style.borderColor='<%= entry.achieved? ? '#00ff88' : '#404040' %>'; this.style.boxShadow='<%= entry.achieved? ? '0 0 10px #00ff88' : 'none' %>'">
              <% if entry.achieved? %>
                <svg style="width: 12px; height: 12px; color: #00ff88; filter: drop-shadow(0 0 3px #00ff88);" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12l5 5L20 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <% end %>
            </button>
          <% end %>
        <% end %>
        <p style="flex: 1; font-size: 14px; line-height: 1.7; color: <%= entry.achieved? ? '#00ff88' : '#b0b0b0' %>; margin: 0; word-break: break-word; <%= 'text-decoration: line-through; opacity: 0.5;' if entry.achieved? %>"><%= entry.content %></p>
      </div>
    </div>
  </div>
</div>

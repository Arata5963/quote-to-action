<%# app/views/post_entries/_entry_card.html.erb %>
<%# Ê°à15: „É™„ÉÉ„ÉÅ„É¢„ÉÄ„É≥Âêπ„ÅçÂá∫„Åó - ÂÖ®ÈÉ®Áõõ„Çä„Éê„Éº„Ç∏„Éß„É≥ %>

<style>
  @keyframes pulse-ring {
    0% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.05); opacity: 0.4; }
    100% { transform: scale(1); opacity: 0.8; }
  }
  @keyframes sparkle {
    0%, 100% { opacity: 0.4; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.2); }
  }
  @keyframes check-pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
</style>

<div id="<%= dom_id(entry) %>" style="display: flex; gap: 10px; padding: 12px; align-items: flex-start; transition: transform 0.2s ease;" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='translateX(0)'">

  <%# „Ç¢„Éê„Çø„ÉºÔºà„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„É™„É≥„Ç∞‰ªò„ÅçÔºâ %>
  <div style="flex-shrink: 0; position: relative;">
    <%# „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥„É™„É≥„Ç∞ %>
    <div style="position: absolute; inset: -3px; border-radius: 14px; background: <%= entry.achieved? ? 'linear-gradient(135deg, #34d399, #10b981, #059669)' : 'linear-gradient(135deg, #667eea, #764ba2, #f472b6)' %>; <%= 'animation: pulse-ring 2s ease-in-out infinite;' unless entry.achieved? %>"></div>

    <% if entry.display_anonymous? %>
      <div style="position: relative; width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(145deg, #a0aec0, #718096); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(113, 128, 150, 0.4);">
        <svg style="width: 20px; height: 20px; color: white;" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
      </div>
    <% elsif entry.display_avatar.present? %>
      <%= image_tag entry.display_avatar.url, style: "position: relative; width: 40px; height: 40px; border-radius: 12px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" %>
    <% else %>
      <div style="position: relative; width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(145deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 16px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);">
        <%= entry.display_user_name&.first&.upcase || '?' %>
      </div>
    <% end %>

    <%# ÈÅîÊàêÊôÇ„Ç≠„É©„Ç≠„É© %>
    <% if entry.achieved? %>
      <div style="position: absolute; -top-1px; -right-1px; font-size: 12px; animation: sparkle 1.5s ease-in-out infinite;">‚ú®</div>
    <% end %>
  </div>

  <%# Âêπ„ÅçÂá∫„Åó %>
  <div style="flex: 1; min-width: 0; position: relative;">
    <%# „Åó„Å£„ÅΩÔºà‰∏âËßíÂΩ¢Ôºâ %>
    <div style="position: absolute; left: -8px; top: 14px; filter: drop-shadow(-1px 1px 1px rgba(0,0,0,0.05));">
      <div style="width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-right: 8px solid <%= entry.achieved? ? '#d1fae5' : '#fff' %>;"></div>
    </div>

    <div style="position: relative; background: <%= entry.achieved? ? 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 50%, #6ee7b7 100%)' : 'linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%)' %>; border-radius: 16px; border-top-left-radius: 4px; padding: 12px 14px; box-shadow: 0 4px 20px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.8); border: 1px solid <%= entry.achieved? ? 'rgba(16, 185, 129, 0.2)' : 'rgba(0,0,0,0.04)' %>; overflow: hidden;">

      <%# Â∑¶Á´Ø„Ç¢„ÇØ„Çª„É≥„Éà„É©„Ç§„É≥ %>
      <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: <%= entry.achieved? ? 'linear-gradient(180deg, #34d399, #10b981, #059669)' : 'linear-gradient(180deg, #667eea, #764ba2, #f472b6)' %>; border-radius: 4px 0 0 4px;"></div>

      <%# ÈÅîÊàêÊôÇ„ÅÆ„ÅäÁ•ù„ÅÑ„Ç™„Éº„Éê„Éº„É¨„Ç§ %>
      <% if entry.achieved? %>
        <div style="position: absolute; top: 8px; right: 8px; transform: rotate(12deg); font-size: 10px; font-weight: 800; color: #059669; background: linear-gradient(135deg, #ecfdf5, #d1fae5); padding: 2px 8px; border-radius: 4px; border: 1px solid #a7f3d0; box-shadow: 0 2px 4px rgba(16,185,129,0.2);">DONE!</div>
      <% end %>

      <%# „Éò„ÉÉ„ÉÄ„Éº: ÂêçÂâç + ÊúüÈôê + „É°„Éã„É•„Éº %>
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; gap: 8px; padding-left: 8px;">
        <%# „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ÂêçÂâç %>
        <span style="font-weight: 700; font-size: 13px; background: <%= entry.achieved? ? 'linear-gradient(135deg, #059669, #10b981)' : 'linear-gradient(135deg, #667eea, #764ba2)' %>; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"><%= entry.display_anonymous? ? 'ÂåøÂêç' : entry.display_user_name %></span>

        <div style="display: flex; align-items: center; gap: 8px; flex-shrink: 0;">
          <%# ÊúüÈôê„Éê„ÉÉ„Ç∏ %>
          <% if entry.deadline.present? %>
            <% deadline_overdue = entry.deadline < Date.current && !entry.achieved? %>
            <span style="font-size: 10px; font-weight: 600; color: <%= deadline_overdue ? '#dc2626' : (entry.achieved? ? '#059669' : '#6366f1') %>; background: <%= deadline_overdue ? '#fef2f2' : (entry.achieved? ? '#ecfdf5' : '#eef2ff') %>; padding: 3px 8px; border-radius: 10px; border: 1px solid <%= deadline_overdue ? '#fecaca' : (entry.achieved? ? '#a7f3d0' : '#c7d2fe') %>;">
              <%= deadline_overdue ? '‚ö†Ô∏è ÊúüÈôêË∂ÖÈÅé' : "üìÖ #{l(entry.deadline, format: :short)}" %>
            </span>
          <% end %>

          <%# 3ÁÇπ„É°„Éã„É•„Éº %>
          <% if user_signed_in? && entry.user == current_user %>
            <details style="position: relative;">
              <summary style="list-style: none; cursor: pointer; padding: 8px; margin: -8px; opacity: 0.5; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.5'">
                <svg style="width: 16px; height: 16px; color: #718096;" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
              </summary>
              <div style="position: absolute; right: 0; top: 100%; margin-top: 4px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.15), 0 2px 10px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; z-index: 10; overflow: hidden;">
                <%= button_to post_post_entry_path(entry.post, entry), method: :delete, data: { turbo_confirm: "ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" }, style: "font-size: 13px; color: #e53e3e; background: none; border: none; cursor: pointer; padding: 12px 20px; white-space: nowrap; transition: background 0.2s;", onmouseover: "this.style.background='#fef2f2'", onmouseout: "this.style.background='transparent'" do %>ÂâäÈô§„Åô„Çã<% end %>
              </div>
            </details>
          <% end %>
        </div>
      </div>

      <%# Êú¨ÊñáÔºàÂ∑¶„Å´‰∏∏„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„ÇπÔºâ %>
      <div style="display: flex; align-items: flex-start; gap: 10px; padding-left: 8px;">
        <% if user_signed_in? && entry.user == current_user %>
          <%= form_with url: achieve_post_post_entry_path(entry.post, entry), method: :patch, style: "flex-shrink: 0; margin-top: 2px;" do %>
            <button type="submit" style="width: 24px; height: 24px; border-radius: 50%; border: none; background: <%= entry.achieved? ? 'linear-gradient(135deg, #34d399, #10b981)' : 'linear-gradient(135deg, #e2e8f0, #cbd5e1)' %>; cursor: pointer; padding: 0; display: flex; align-items: center; justify-content: center; box-shadow: <%= entry.achieved? ? '0 2px 8px rgba(16,185,129,0.4), inset 0 1px 0 rgba(255,255,255,0.3)' : '0 2px 4px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.8)' %>; transition: transform 0.2s, box-shadow 0.2s; <%= 'animation: check-pop 0.3s ease;' if entry.achieved? %>" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='<%= entry.achieved? ? '0 2px 8px rgba(16,185,129,0.4)' : '0 2px 4px rgba(0,0,0,0.1)' %>'">
              <% if entry.achieved? %>
                <svg style="width: 14px; height: 14px; color: white; filter: drop-shadow(0 1px 1px rgba(0,0,0,0.2));" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M5 12l5 5L20 7" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <% end %>
            </button>
          <% end %>
        <% end %>
        <p style="flex: 1; font-size: 14px; line-height: 1.7; color: <%= entry.achieved? ? '#065f46' : '#1e293b' %>; margin: 0; word-break: break-word; <%= 'text-decoration: line-through; opacity: 0.7;' if entry.achieved? %>"><%= entry.content %></p>
      </div>
    </div>
  </div>
</div>

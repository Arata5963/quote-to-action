<%# app/views/posts/index.html.erb %>
<%# シンプルな時系列表示 + もっと見るボタン %>

<div class="min-h-screen bg-white">
  <%# ===== 統合検索バー ===== %>
  <div class="border-b border-gray-100">
    <div class="max-w-xl mx-auto px-4 py-3">
      <div class="relative"
           data-controller="index-search"
           data-index-search-youtube-url-value="<%= youtube_search_posts_path %>"
           data-index-search-find-or-create-url-value="<%= find_or_create_posts_path %>">
        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4">
          <svg class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </div>
        <input type="text"
               data-index-search-target="input"
               data-action="input->index-search#handleInput keydown->index-search#handleKeydown"
               placeholder="URLを貼り付け、またはタイトルで検索..."
               class="w-full rounded-lg border border-gray-200 bg-white pl-11 pr-4 py-3 text-sm text-gray-900 placeholder:text-gray-400 focus:border-orange-300 focus:ring-2 focus:ring-orange-100 focus:outline-none transition-colors">
        <%# 検索結果ドロップダウン %>
        <div data-index-search-target="results"
             class="hidden absolute z-20 w-full bg-white border border-gray-200 rounded-lg shadow-lg mt-1 max-h-96 overflow-y-auto">
        </div>
      </div>
    </div>
  </div>

  <%# ===== メインコンテンツ ===== %>
  <div class="max-w-4xl mx-auto px-8 md:px-12 py-5">
    <% if @filter_user.present? %>
      <%# ユーザーフィルター時のヘッダー %>
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <h1 class="text-lg font-bold text-gray-900">投稿一覧</h1>
          <span class="text-gray-400">by</span>
          <span class="text-gray-600"><%= @filter_user.name %></span>
        </div>
        <%= link_to user_profile_path(@filter_user), class: "text-sm text-gray-500 hover:text-gray-700" do %>
          ← 戻る
        <% end %>
      </div>
    <% end %>

    <%# ===== 投稿一覧 ===== %>
    <% if @posts.blank? %>
      <%# 空状態 %>
      <div class="py-16 text-center">
        <span class="text-5xl block mb-4">📺</span>
        <p class="text-gray-700 font-medium mb-2">まだアウトプットがありません</p>
        <p class="text-sm text-gray-500 mb-6">YouTube動画を見たら記録してみましょう</p>
        <% if user_signed_in? %>
          <%= link_to new_post_path, class: "inline-flex items-center gap-2 px-6 py-2.5 bg-orange-500 text-white rounded-full font-medium hover:bg-orange-600 transition-colors" do %>
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
            </svg>
            最初のアウトプットを記録
          <% end %>
        <% else %>
          <%= link_to new_user_session_path, class: "inline-flex items-center gap-2 px-6 py-2.5 bg-orange-500 text-white rounded-full font-medium hover:bg-orange-600 transition-colors" do %>
            ログインして始める
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div data-controller="load-more">
        <%# 投稿グリッド %>
        <div id="posts-container"
             data-load-more-target="container"
             class="grid gap-4"
             style="grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));">
          <% @posts.each do |post| %>
            <%= render 'posts/post_card_note', post: post %>
          <% end %>
        </div>

        <%# もっと見るボタン %>
        <%= render 'posts/load_more_button', posts: @posts %>
      </div>
    <% end %>
  </div>
</div>

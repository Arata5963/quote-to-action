<%# app/views/posts/_categorized_comments.html.erb %>
<%# YouTubeコメント表示（ブックマーク機能付き） %>

<div id="youtube-comments-section" class="mb-8">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-base font-bold text-gray-900 flex items-center gap-2">
      <svg class="w-5 h-5 text-red-500" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
      </svg>
      YouTubeコメント
    </h3>
    <span class="text-xs text-gray-400">いいね数TOP50</span>
  </div>

  <%# コメント一覧 %>
  <div id="comments-list" class="space-y-3">
    <% if defined?(youtube_comments) && youtube_comments.present? %>
      <% youtube_comments.each do |comment| %>
        <div class="flex gap-3 p-4 bg-gray-50 rounded-xl">
          <%# アバター %>
          <% if comment.author_image_url.present? %>
            <img src="<%= comment.author_image_url %>"
                 alt="<%= comment.author_name %>"
                 class="w-10 h-10 rounded-full flex-shrink-0">
          <% else %>
            <div class="w-10 h-10 rounded-full bg-gray-200 flex-shrink-0 flex items-center justify-center">
              <svg class="w-5 h-5 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </div>
          <% end %>

          <div class="flex-1 min-w-0">
            <%# ヘッダー：著者名 + いいね %>
            <div class="flex items-center gap-2 mb-1">
              <% if comment.author_channel_url.present? %>
                <a href="<%= comment.author_channel_url %>"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="text-sm font-medium text-gray-900 hover:text-blue-600 truncate">
                  <%= comment.author_name %>
                </a>
              <% else %>
                <span class="text-sm font-medium text-gray-900 truncate"><%= comment.author_name %></span>
              <% end %>

              <% if comment.like_count > 0 %>
                <span class="flex items-center gap-0.5 text-xs text-gray-500">
                  <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2 20h2c.55 0 1-.45 1-1v-9c0-.55-.45-1-1-1H2v11zm19.83-7.12c.11-.25.17-.52.17-.8V11c0-1.1-.9-2-2-2h-5.5l.92-4.65c.05-.22.02-.46-.08-.66-.23-.45-.52-.86-.88-1.22L14 2 7.59 8.41C7.21 8.79 7 9.3 7 9.83v7.84C7 18.95 8.05 20 9.34 20h8.11c.7 0 1.36-.37 1.72-.97l2.66-6.15z"/>
                  </svg>
                  <%= number_with_delimiter(comment.like_count) %>
                </span>
              <% end %>
            </div>

            <%# コメント本文 %>
            <p class="text-sm text-gray-700 whitespace-pre-line mb-3 line-clamp-4"><%= comment.content %></p>

            <%# ブックマークボタン %>
            <div class="flex items-center">
              <%= render "comment_bookmarks/button", youtube_comment: comment, bookmarked: comment.bookmarked_by?(current_user) %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="text-center py-8 text-gray-500">
        <p class="text-sm">コメントを取得できませんでした</p>
      </div>
    <% end %>
  </div>
</div>

<%# app/views/posts/_post_card.html.erb %>
<%# 投稿カード（横型・2列グリッド対応・高さ統一） %>

<article class="bg-white rounded-lg border border-gray-200 p-4 hover:border-gray-300 transition-colors group h-full">
  <div class="flex items-center gap-4 h-full">

    <%# 左側: サムネイル %>
    <%= link_to post_path(post, from: local_assigns[:from]), class: "flex-shrink-0" do %>
      <div class="w-40 aspect-video rounded-lg overflow-hidden bg-accent/10">
        <%= image_tag post.youtube_thumbnail_url(size: :mqdefault),
              alt: post.youtube_title || post.action_plan,
              class: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",
              loading: "lazy" %>
      </div>
    <% end %>

    <%# 右側: コンテンツ（flex-colで縦配置） %>
    <div class="flex-1 min-w-0 flex flex-col">

      <%# 上部: ユーザー情報 + いいね（固定位置） %>
      <div class="flex items-center justify-between gap-2">
        <%= link_to user_profile_path(post.user), class: "flex items-center gap-2 min-w-0 hover:opacity-80 transition-opacity" do %>
          <% if post.user.avatar.present? %>
            <%= image_tag post.user.avatar.url,
                  alt: display_name(post.user),
                  class: "w-6 h-6 rounded-full object-cover flex-shrink-0" %>
          <% else %>
            <div class="w-6 h-6 bg-accent/10 rounded-full flex items-center justify-center flex-shrink-0">
              <svg class="w-3.5 h-3.5 text-primary/40" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </div>
          <% end %>
          <span class="text-sm font-medium text-primary truncate"><%= display_name(post.user) %></span>
        <% end %>

        <%# 応援ボタン %>
        <div id="cheer_button_<%= post.id %>" class="flex-shrink-0">
          <%= render 'cheers/cheer_button_minimal', post: post %>
        </div>
      </div>

      <%# 中央: アクションプラン（2行分の高さを固定確保） %>
      <%= link_to post_path(post, from: local_assigns[:from]), class: "block mt-2" do %>
        <h3 class="text-base font-medium text-primary line-clamp-2 h-12 group-hover:text-accent transition-colors leading-normal">
          <%= post.action_plan %>
        </h3>
      <% end %>

      <%# 下部: 達成状況・期日バッジ（mt-autoで下部固定） %>
      <div class="flex items-center gap-2 mt-auto pt-2 flex-wrap">
        <% if post.achieved? %>
          <span class="text-xs bg-accent text-white px-2.5 py-1 rounded-full">
            達成済み
          </span>
        <% else %>
          <%# 期日バッジ %>
          <% if post.deadline_passed? %>
            <span class="text-xs bg-primary/10 text-primary/60 px-2.5 py-1 rounded-full">
              📅 期日超過
            </span>
          <% elsif post.deadline_near? %>
            <span class="text-xs bg-orange-100 text-orange-600 px-2.5 py-1 rounded-full">
              <% days = post.days_until_deadline %>
              ⏰ <% if days == 0 %>今日まで<% else %>あと<%= days %>日<% end %>
            </span>
          <% else %>
            <span class="text-xs border border-accent/30 text-primary/50 px-2.5 py-1 rounded-full">
              みただけ？
            </span>
          <% end %>
        <% end %>
      </div>

    </div>
  </div>
</article>

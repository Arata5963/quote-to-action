<%# app/views/posts/show.html.erb %>
<% content_for :title, @post.trigger_content.truncate(30) %>

<div class="max-w-2xl mx-auto px-4 py-8 bg-white min-h-screen">
  <div class="bg-white border-2 border-black p-6 lg:p-8">
    <%# ページタイトル %>
    <div class="text-center mb-8 relative">
      <div class="flex items-center justify-center gap-2 mb-4">
        <svg class="w-6 h-6 text-black fill-current" viewBox="0 0 24 24">
          <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
        </svg>
        <h1 class="text-2xl font-bold text-black">投稿詳細</h1>
      </div>
      <div class="w-16 h-1 bg-black mx-auto"></div>

      <%# 編集/削除アイコン（タイトル右上に配置） %>
      <% if user_signed_in? && @post.user == current_user %>
        <div class="absolute right-0 top-0 flex items-center gap-1">
          <%# 編集アイコン %>
          <%= link_to edit_post_path(@post),
                class: "inline-flex p-2 text-black hover:bg-gray-100 focus:outline-none",
                aria: { label: "編集" }, title: "編集" do %>
            <svg class="h-5 w-5 fill-current" viewBox="0 0 24 24">
              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
          <% end %>

          <%# 削除アイコン %>
          <%= link_to post_path(@post),
                data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" },
                class: "inline-flex p-2 text-black hover:bg-gray-100 focus:outline-none",
                aria: { label: "削除" }, title: "削除" do %>
            <svg class="h-5 w-5 fill-current" viewBox="0 0 24 24">
              <path d="M3 6v18h18v-2H5V6h14V4H3v2zm16-2v2H9V4h10z"/>
            </svg>
          <% end %>
        </div>
      <% end %>
    </div>

      <%# きっかけ表示 %>
      <div class="p-4">
        <div class="flex items-center gap-2 mb-3">
          <svg class="w-5 h-5 text-black fill-current" viewBox="0 0 24 24">
            <path d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <h2 class="text-sm font-bold text-black uppercase tracking-wide">きっかけ</h2>
        </div>
        <div class="w-full px-3 py-2 border-2 border-black text-black bg-gray-50 min-h-[100px] whitespace-pre-line">
          <%= @post.trigger_content %>
        </div>
      </div>

      <%# アクションプラン表示 %>
      <div class="p-4">
        <div class="flex items-center gap-2 mb-3">
          <svg class="w-5 h-5 text-black fill-current" viewBox="0 0 24 24">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <h2 class="text-sm font-bold text-black uppercase tracking-wide">アクションプラン</h2>
        </div>
        <div class="w-full px-3 py-2 border-2 border-black text-black bg-gray-50 min-h-[100px] whitespace-pre-line">
          <%= @post.action_plan %>
        </div>
      </div>
      <%# ボタンエリア - 左右配置 %>
      <div class="pt-4 flex justify-between items-center">
        <%# 左側：一覧に戻るボタン %>
        <div>
          <%= link_to posts_path, class: "inline-flex items-center gap-2 text-black hover:bg-gray-100 px-4 py-2 font-bold transition-colors border border-black" do %>
            <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
              <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.42-1.41L7.83 13H20v-2z"/>
            </svg>
            <span>一覧に戻る</span>
          <% end %>
        </div>

        <%# 右側：達成ボタンエリア %>
        <div>
          <% if user_signed_in? && @post.user == current_user %>
            <% done_today = @post.achievements.today.exists?(user_id: current_user.id) %>
            <% unless done_today %>
              <%# 未達成時：達成記録ボタン %>
              <%= button_to post_achievements_path(@post), method: :post,
                    class: "inline-flex items-center gap-2 bg-black hover:bg-gray-800 text-white px-8 py-3 transition-colors font-bold text-lg border-2 border-black" do %>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>達成</span>
              <% end %>
            <% else %>
              <%# 達成済み時：取り消しボタン %>
              <%= button_to post_achievement_path(@post, current_user.achievements.today.find_by(post: @post)),
                    method: :delete,
                    data: { turbo_confirm: "今日の達成記録を取り消しますか？" },
                    class: "inline-flex items-center gap-2 bg-gray-600 hover:bg-gray-800 text-white px-8 py-3 transition-colors font-bold text-lg border-2 border-gray-600" do %>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
                <span>達成を取り消し</span>
              <% end %>
            <% end %>
          <% elsif user_signed_in? %>
            <%# 他人の投稿の場合 %>
            <div class="text-black text-sm border-2 border-black p-4 bg-gray-50 text-center">
              <svg class="w-4 h-4 inline-block mr-1 fill-current" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
              </svg>
              この投稿の所有者のみ達成記録できます
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
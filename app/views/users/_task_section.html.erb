<%# app/views/users/_task_section.html.erb %>
<%# 横スクロールタスクセクション %>

<% title_class ||= 'text-gray-700' %>
<% count_class ||= 'text-gray-400' %>
<% show_nav = tasks.size > 5 %>

<section class="task-section" data-controller="horizontal-scroll">
  <%# ヘッダー %>
  <div class="flex items-center gap-2 mb-3">
    <span class="text-base"><%= icon %></span>
    <h2 class="text-sm font-medium <%= title_class %>"><%= title %></h2>
    <span class="text-xs <%= count_class %>">(<%= tasks.size %>)</span>
  </div>

  <%# メインコンテナ（矢印 + スクロールエリア + 矢印） %>
  <div class="task-carousel">
    <%# 左矢印エリア（常にスペース確保） %>
    <div class="task-carousel-nav task-carousel-nav-left">
      <% if show_nav %>
        <button type="button"
                class="task-carousel-btn hidden"
                data-horizontal-scroll-target="leftBtn"
                data-action="click->horizontal-scroll#scrollLeft"
                aria-label="左へスクロール">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
      <% end %>
    </div>

    <%# スクロール可能エリア %>
    <div class="task-carousel-track">
      <div class="task-carousel-container"
           data-horizontal-scroll-target="container"
           data-action="scroll->horizontal-scroll#onScroll">
        <% tasks.each do |task| %>
          <%= render 'post_entries/task_card', task: task %>
        <% end %>
        <div class="task-scroll-spacer" aria-hidden="true"></div>
      </div>

      <%# フェードエフェクト（5件超の場合のみ） %>
      <% if show_nav %>
        <div class="task-carousel-fade task-carousel-fade-left hidden"
             data-horizontal-scroll-target="leftFade"></div>
        <div class="task-carousel-fade task-carousel-fade-right"
             data-horizontal-scroll-target="rightFade"></div>
      <% end %>
    </div>

    <%# 右矢印エリア（常にスペース確保） %>
    <div class="task-carousel-nav task-carousel-nav-right">
      <% if show_nav %>
        <button type="button"
                class="task-carousel-btn"
                data-horizontal-scroll-target="rightBtn"
                data-action="click->horizontal-scroll#scrollRight"
                aria-label="右へスクロール">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      <% end %>
    </div>
  </div>
</section>

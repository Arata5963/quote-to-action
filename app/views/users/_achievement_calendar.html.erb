<%# app/views/users/_achievement_calendar.html.erb %>
<%# 達成カレンダーセクション %>
<div>

  <%# 月表示 %>
  <div class="text-center mb-6">
    <span class="text-lg font-semibold text-primary">
      <%= @calendar_year %>年<%= @calendar_month %>月
    </span>
  </div>

  <%# 曜日ヘッダー %>
  <div class="grid grid-cols-7 gap-2 mb-2">
    <% weekday_headers.each do |weekday| %>
      <div class="text-center text-xs font-medium text-primary/60">
        <%= weekday %>
      </div>
    <% end %>
  </div>

  <%# カレンダーグリッド %>
  <div class="grid grid-cols-7 gap-1 mb-6">
    <% calendar_days = generate_monthly_calendar(@achievement_data, @calendar_year, @calendar_month) %>
    <% calendar_days.each do |cell| %>
      <div class="h-12 sm:h-14">
        <% if cell[:type] == :blank %>
          <%# 空白セル %>
          <div class="w-full h-full"></div>
        <% elsif cell[:has_achievement] %>
          <%# 達成あり：サムネイル表示 %>
          <% if cell[:post] %>
            <%= link_to post_path(cell[:post]), class: "block w-full h-full relative group" do %>
              <div class="w-full h-full rounded-lg overflow-hidden shadow-sm ring-2 ring-accent/50">
                <%= image_tag cell[:thumbnail_url],
                    alt: "達成",
                    class: "w-full h-full object-cover",
                    loading: "lazy" %>
                <%# 日付オーバーレイ %>
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                <span class="absolute bottom-0.5 left-1 text-[10px] font-bold text-white drop-shadow">
                  <%= cell[:day] %>
                </span>
                <%# 複数達成バッジ %>
                <% if cell[:achievement_count] > 1 %>
                  <span class="absolute top-0.5 right-0.5 bg-accent text-white text-[8px] font-bold px-1 rounded-full shadow">
                    +<%= cell[:achievement_count] - 1 %>
                  </span>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <%# サムネイルなし（フォールバック） %>
            <div class="bg-accent text-white shadow-sm w-full h-full rounded-lg flex items-center justify-center text-xs font-medium">
              <%= cell[:day] %>
            </div>
          <% end %>
        <% else %>
          <%# 達成なし %>
          <div class="bg-cream text-primary/40 w-full h-full rounded-lg flex items-center justify-center text-xs font-medium transition-all">
            <%= cell[:day] %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <%# 凡例 %>
  <div class="flex items-center justify-center gap-4 text-xs text-primary/60">
    <div class="flex items-center gap-2">
      <div class="w-4 h-4 rounded bg-accent"></div>
      <span>達成あり</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-4 rounded bg-cream border border-primary/10"></div>
      <span>達成なし</span>
    </div>
  </div>

</div>
